<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة قطع الغيار - Peugeot</title>
    <style>
        .card { width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .card img { width: 100px; height: 100px; object-fit: cover; }
        .part-title { font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>
    <h1>إدارة قطع غيار سيارات Peugeot</h1>

    <!-- إضافة موديلات السيارات -->
    <h2>إضافة موديلات سيارات Peugeot</h2>
    <button onclick="addPeugeotModelsIfEmpty()">إضافة موديلات Peugeot إذا كانت قاعدة البيانات فارغة</button>

    <hr>

    <!-- البحث عن قطع الغيار -->
    <h2>البحث عن قطع الغيار</h2>
    <label for="searchCarModel">اختيار موديل السيارة:</label>
    <select id="searchCarModel" onchange="searchParts()">
        <option value="">اختر موديل السيارة</option>
    </select>
    <div id="partsList"></div>

    <hr>

    <!-- حذف موديل السيارة -->
    <h2>حذف موديل سيارة</h2>
    <label for="deleteCarModel">اختيار موديل السيارة للحذف:</label>
    <select id="deleteCarModel">
        <option value="">اختر موديل السيارة</option>
    </select>
    <button onclick="deleteCarModel()">حذف موديل السيارة</button>

    <script>
        let db;

        // فتح قاعدة البيانات
        const request = indexedDB.open("carPartsDB", 1);

        request.onupgradeneeded = function(e) {
            db = e.target.result;
            if (!db.objectStoreNames.contains("cars")) {
                const store = db.createObjectStore("cars", { keyPath: "carModel" });
                store.createIndex("engineType", "engineType", { unique: false });
            }
        };

        request.onsuccess = function(e) {
            db = e.target.result;
            loadCarModels(); // تحميل موديلات السيارات عند فتح قاعدة البيانات
            addPeugeotModelsIfEmpty(); // إضافة موديلات Peugeot إذا كانت قاعدة البيانات فارغة
        };

        request.onerror = function(e) {
            console.error("Error opening database", e.target.error);
        };

        // إضافة موديلات سيارات Peugeot إذا كانت قاعدة البيانات فارغة
        function addPeugeotModelsIfEmpty() {
            const transaction = db.transaction("cars", "readwrite");
            const store = transaction.objectStore("cars");
            const request = store.getAll();

            request.onsuccess = function(e) {
                const carData = e.target.result;
                if (carData.length === 0) {
                    const peugeotModels = [
                        { carModel: "Peugeot 106", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 206", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 207", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 208", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 306", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 307", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 308", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 406", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 407", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 508", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 607", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 2008", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 3008", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 4008", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 5008", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 408", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot RCZ", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 208 GTi", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 308 GTi", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot 9X8", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot e-208", engineType: "electric", parts: [] },
                        { carModel: "Peugeot e-2008", engineType: "electric", parts: [] },
                        { carModel: "Peugeot e-308", engineType: "electric", parts: [] },
                        { carModel: "Peugeot e-3008", engineType: "electric", parts: [] },
                        { carModel: "Peugeot Partner", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot Expert", engineType: "petrol", parts: [] },
                        { carModel: "Peugeot Rifter", engineType: "petrol", parts: [] }
                    ];

                    peugeotModels.forEach(model => {
                        store.put(model); // إضافة موديلات السيارات إلى قاعدة البيانات
                    });

                    alert("تم إضافة موديلات سيارات Peugeot بنجاح!");
                    loadCarModels(); // إعادة تحميل موديلات السيارات بعد إضافتها
                } else {
                    loadCarModels(); // تحميل الموديلات من القاعدة إذا كانت قد أُضيفت مسبقًا
                }
            };

            request.onerror = function(e) {
                console.error("Error checking if database is empty", e.target.error);
            };
        }

        // تحميل موديلات السيارات إلى قوائم الاختيار
        function loadCarModels() {
            const transaction = db.transaction("cars", "readonly");
            const store = transaction.objectStore("cars");
            const request = store.getAll();

            request.onsuccess = function(e) {
                const carData = e.target.result;
                const carModelSelects = document.querySelectorAll("select[id^='carModel']");
                
                // ملء قوائم اختيار موديلات السيارة في البحث والإضافة
                carModelSelects.forEach(select => {
                    select.innerHTML = '<option value="">اختر موديل السيارة</option>';
                    carData.forEach(car => {
                        const option = document.createElement('option');
                        option.value = car.carModel;
                        option.textContent = car.carModel;
                        select.appendChild(option);
                    });
                });
            };
        }

        // البحث عن قطع الغيار للموديل المختار
        function searchParts() {
            const carModel = document.getElementById("searchCarModel").value;

            if (carModel) {
                const transaction = db.transaction("cars", "readonly");
                const store = transaction.objectStore("cars");
                const request = store.get(carModel);

                request.onsuccess = function(e) {
                    const carData = e.target.result;
                    const partsList = document.getElementById("partsList");
                    partsList.innerHTML = ""; // مسح القائمة القديمة

                    if (carData && carData.parts.length > 0) {
                        carData.parts.forEach(part => {
                            const partCard = document.createElement("div");
                            partCard.classList.add("card");
                            partCard.innerHTML = `
                                <img src="${part.image}" alt="Part Image">
                                <div class="part-title">${part.name}</div>
                                <p><strong>رقم القطعة:</strong> ${part.number}</p>
                                <p><strong>السعر:</strong> ${part.price}</p>
                                <p><strong>الوصف:</strong> ${part.description}</p>
                            `;
                            partsList.appendChild(partCard);
                        });
                    } else {
                        partsList.innerHTML = "<p>لا توجد قطع غيار لهذا الموديل.</p>";
                    }
                };

                request.onerror = function(e) {
                    console.error("Error searching for parts", e.target.error);
                };
            } else {
                alert("يرجى اختيار موديل السيارة أولاً.");
            }
        }

        // حذف موديل السيارة
        function deleteCarModel() {
            const carModel = document.getElementById("deleteCarModel").value;

            if (carModel) {
                const transaction = db.transaction("cars", "readwrite");
                const store = transaction.objectStore("cars");
                const request = store.delete(carModel);

                request.onsuccess = function() {
                    alert(`تم حذف موديل السيارة ${carModel} بنجاح.`);
                    loadCarModels(); // إعادة تحميل موديلات السيارات بعد الحذف
                };

                request.onerror = function(e) {
                    console.error("Error deleting car model", e.target.error);
                };
            } else {
                alert("يرجى اختيار موديل السيارة للحذف.");
            }
        }
    </script>
</body>
</html>
